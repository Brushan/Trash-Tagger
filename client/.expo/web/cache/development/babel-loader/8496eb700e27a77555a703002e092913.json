{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/Users/carl.orre/trash/Trash/client/components/Camera/Camera.jsx\";\nimport React, { useState, useEffect } from 'react';\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport ImageBackground from \"react-native-web/dist/exports/ImageBackground\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { Camera } from 'expo-camera';\nimport * as Location from 'expo-location';\nimport axios from 'axios';\nimport { v4 as uuidv4 } from 'uuid';\nimport firebase from \"../../firebase.js\";\nimport { preventAutoHide } from 'expo/build/launch/SplashScreen';\nimport * as Progress from 'react-native-progress';\n\nvar CameraView = function CameraView(_ref) {\n  var user = _ref.user;\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      hasPermission = _useState2[0],\n      setHasPermission = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      cameraRef = _useState4[0],\n      setCameraRef = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      photo = _useState6[0],\n      setPhoto = _useState6[1];\n\n  var _useState7 = useState(null),\n      _useState8 = _slicedToArray(_useState7, 2),\n      location = _useState8[0],\n      setLocation = _useState8[1];\n\n  var _useState9 = useState(null),\n      _useState10 = _slicedToArray(_useState9, 2),\n      imagePath = _useState10[0],\n      setImagePath = _useState10[1];\n\n  var _useState11 = useState(null),\n      _useState12 = _slicedToArray(_useState11, 2),\n      progress = _useState12[0],\n      setProgress = _useState12[1];\n\n  var _useState13 = useState(true),\n      _useState14 = _slicedToArray(_useState13, 2),\n      uploadComplete = _useState14[0],\n      setUploadComplete = _useState14[1];\n\n  useEffect(function () {\n    (function _callee() {\n      var _await$Camera$request, status, local;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(Camera.requestPermissionsAsync());\n\n            case 2:\n              _await$Camera$request = _context.sent;\n              status = _await$Camera$request.status;\n              _context.next = 6;\n              return _regeneratorRuntime.awrap(Location.requestPermissionsAsync().status);\n\n            case 6:\n              local = _context.sent;\n              setHasPermission(status === 'granted');\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    })();\n  }, []);\n\n  var uploadPhoto = function uploadPhoto() {\n    var response, blob, reader;\n    return _regeneratorRuntime.async(function uploadPhoto$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            _context4.next = 3;\n            return _regeneratorRuntime.awrap(fetch(photo.uri));\n\n          case 3:\n            response = _context4.sent;\n            _context4.next = 6;\n            return _regeneratorRuntime.awrap(response.blob());\n\n          case 6:\n            blob = _context4.sent;\n            reader = new FileReader();\n            reader.readAsDataURL(blob);\n\n            reader.onloadend = function () {\n              var base64data = reader.result;\n              var API_KEY = 'AIzaSyByFev4TGGQQW9leJiMUTdtfGl_YD4Jnb8';\n              var API_URL = \"https://vision.googleapis.com/v1/images:annotate?key=\" + API_KEY;\n\n              function callGoogleVisionAsync(image) {\n                var body, response, parsed, storageRef;\n                return _regeneratorRuntime.async(function callGoogleVisionAsync$(_context3) {\n                  while (1) {\n                    switch (_context3.prev = _context3.next) {\n                      case 0:\n                        body = {\n                          requests: [{\n                            image: {\n                              content: image\n                            },\n                            features: [{\n                              type: \"SAFE_SEARCH_DETECTION\",\n                              maxResults: 1\n                            }]\n                          }]\n                        };\n                        _context3.next = 3;\n                        return _regeneratorRuntime.awrap(fetch(API_URL, {\n                          method: 'POST',\n                          headers: {\n                            'Accept': 'application/json',\n                            'Content-Type': 'application/json'\n                          },\n                          body: JSON.stringify(body)\n                        }));\n\n                      case 3:\n                        response = _context3.sent;\n                        _context3.next = 6;\n                        return _regeneratorRuntime.awrap(response.json());\n\n                      case 6:\n                        parsed = _context3.sent;\n\n                        if (parsed.responses[0].safeSearchAnnotation.adult === 'VERY_LIKELY' || parsed.responses[0].safeSearchAnnotation.adult === 'LIKELY' || parsed.responses[0].safeSearchAnnotation.adult === 'POSSIBLE' || parsed.responses[0].safeSearchAnnotation.racy === 'VERY_LIKELY' || parsed.responses[0].safeSearchAnnotation.racy === 'LIKELY' || parsed.responses[0].safeSearchAnnotation.racy === 'POSSIBLE' || parsed.responses[0].safeSearchAnnotation.violence === 'VERY_LIKELY' || parsed.responses[0].safeSearchAnnotation.violence === 'LIKELY' || parsed.responses[0].safeSearchAnnotation.violence === 'POSSIBLE') {\n                          alert('Your image is not appropriate. Please try again');\n                        } else {\n                          storageRef = firebase.storage().ref().child('images/' + imagePath);\n                          setUploadComplete(false);\n                          storageRef.put(blob).on('state_changed', function (snapshot) {\n                            var progress1 = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n                            setProgress(progress1);\n\n                            switch (snapshot.state) {\n                              case firebase.storage.TaskState.PAUSED:\n                                break;\n\n                              case firebase.storage.TaskState.RUNNING:\n                                break;\n                            }\n                          }, function (error) {\n                            console.log(error);\n                          }, function _callee2() {\n                            var url;\n                            return _regeneratorRuntime.async(function _callee2$(_context2) {\n                              while (1) {\n                                switch (_context2.prev = _context2.next) {\n                                  case 0:\n                                    if (progress === 100 || progress === null) {\n                                      Alert.alert('Upload', 'Upload Complete', [{\n                                        text: 'OK',\n                                        onPress: function onPress() {\n                                          setUploadComplete('true');\n                                        }\n                                      }]);\n                                    }\n\n                                    _context2.next = 3;\n                                    return _regeneratorRuntime.awrap(storageRef.getDownloadURL());\n\n                                  case 3:\n                                    url = _context2.sent;\n                                    _context2.next = 6;\n                                    return _regeneratorRuntime.awrap(axios({\n                                      method: 'post',\n                                      url: 'https://us-central1-trash-2b5de.cloudfunctions.net/app/api/locations',\n                                      data: {\n                                        id: uuidv4(),\n                                        lat: location.coords.latitude,\n                                        long: location.coords.longitude,\n                                        completed: false,\n                                        uri: url,\n                                        user: user\n                                      }\n                                    }));\n\n                                  case 6:\n                                  case \"end\":\n                                    return _context2.stop();\n                                }\n                              }\n                            }, null, null, null, Promise);\n                          });\n                        }\n\n                        return _context3.abrupt(\"return\", parsed.responses[0]);\n\n                      case 9:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }\n                }, null, null, null, Promise);\n              }\n\n              callGoogleVisionAsync(base64data.slice(23));\n            };\n\n            _context4.next = 15;\n            break;\n\n          case 12:\n            _context4.prev = 12;\n            _context4.t0 = _context4[\"catch\"](0);\n            console.log(_context4.t0);\n\n          case 15:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 12]], Promise);\n  };\n\n  if (hasPermission === null) {\n    return React.createElement(View, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 16\n      }\n    });\n  }\n\n  if (hasPermission === false) {\n    return React.createElement(Text, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 16\n      }\n    }, \"No access to camera\");\n  }\n\n  return React.createElement(View, {\n    style: {\n      flex: 1,\n      width: '100%'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 8\n    }\n  }, photo ? React.createElement(ImageBackground, {\n    style: {\n      flex: 1\n    },\n    source: {\n      uri: photo.uri\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 22\n    }\n  }, React.createElement(TouchableOpacity, {\n    onPress: function onPress() {\n      setPhoto(null);\n    },\n    style: {\n      elevation: 8,\n      borderRadius: 10,\n      paddingVertical: 10,\n      paddingHorizontal: 12,\n      backgroundColor: '#D65F56',\n      height: 45,\n      width: 120,\n      position: 'absolute',\n      left: 20,\n      bottom: 20\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 13\n    }\n  }, React.createElement(Text, {\n    style: styles.backbtn,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 16\n    }\n  }, \"Back\")), React.createElement(TouchableOpacity, {\n    onPress: function _callee3() {\n      return _regeneratorRuntime.async(function _callee3$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _regeneratorRuntime.awrap(uploadPhoto());\n\n            case 2:\n              setPhoto(null);\n\n            case 3:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    },\n    style: {\n      elevation: 8,\n      borderRadius: 10,\n      paddingVertical: 10,\n      paddingHorizontal: 12,\n      backgroundColor: '#148744',\n      height: 45,\n      width: 120,\n      position: 'absolute',\n      right: 20,\n      bottom: 20\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 13\n    }\n  }, React.createElement(Text, {\n    style: styles.uploadbtn,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 16\n    }\n  }, \"Upload\"))) : React.createElement(Camera, {\n    style: {\n      flex: 1\n    },\n    type: Camera.Constants.Type.back,\n    ref: function ref(_ref2) {\n      setCameraRef(_ref2);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 16\n    }\n  }, React.createElement(View, {\n    style: {\n      flex: 1,\n      alignSelf: 'center'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 16\n    }\n  }, uploadComplete === false ? React.createElement(Progress.Bar, {\n    progress: progress,\n    width: 200,\n    style: {\n      position: 'relative',\n      top: 75\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 45\n    }\n  }) : React.createElement(View, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 136\n    }\n  }), React.createElement(TouchableOpacity, {\n    style: {\n      alignSelf: 'center'\n    },\n    onPress: function _callee4() {\n      var _photo, filename, _location;\n\n      return _regeneratorRuntime.async(function _callee4$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              if (!cameraRef) {\n                _context6.next = 11;\n                break;\n              }\n\n              _context6.next = 3;\n              return _regeneratorRuntime.awrap(cameraRef.takePictureAsync({\n                quality: 0.1,\n                base64: true\n              }));\n\n            case 3:\n              _photo = _context6.sent;\n              filename = uuidv4();\n              setPhoto(_photo);\n              setImagePath(filename);\n              _context6.next = 9;\n              return _regeneratorRuntime.awrap(Location.getCurrentPositionAsync({}));\n\n            case 9:\n              _location = _context6.sent;\n              setLocation(_location);\n\n            case 11:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 17\n    }\n  }, React.createElement(View, {\n    style: styles.shutterBtnCont,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 21\n    }\n  }, React.createElement(View, {\n    style: {\n      borderWidth: 2,\n      borderRadius: \"10%\",\n      borderColor: 'white',\n      height: 50,\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 25\n    }\n  }, React.createElement(View, {\n    style: {\n      borderWidth: 2,\n      borderRadius: \"50%\",\n      boarderColor: 'white',\n      height: 40,\n      width: 40,\n      backgroundColor: 'white'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 33\n    }\n  })))))));\n};\n\nvar styles = StyleSheet.create({\n  backbtn: {\n    color: 'white',\n    fontSize: 18,\n    fontWeight: 'bold',\n    alignSelf: 'center',\n    textTransform: 'uppercase'\n  },\n  uploadbtn: {\n    color: 'white',\n    fontSize: 18,\n    fontWeight: 'bold',\n    alignSelf: 'center',\n    textTransform: 'uppercase'\n  },\n  shutterBtnCont: {\n    flex: 1,\n    justifyContent: 'flex-end',\n    marginBottom: 36\n  }\n});\nexport default CameraView;","map":{"version":3,"sources":["/Users/carl.orre/trash/Trash/client/components/Camera/Camera.jsx"],"names":["React","useState","useEffect","Camera","Location","axios","v4","uuidv4","firebase","preventAutoHide","Progress","CameraView","user","hasPermission","setHasPermission","cameraRef","setCameraRef","photo","setPhoto","location","setLocation","imagePath","setImagePath","progress","setProgress","uploadComplete","setUploadComplete","requestPermissionsAsync","status","local","uploadPhoto","fetch","uri","response","blob","reader","FileReader","readAsDataURL","onloadend","base64data","result","API_KEY","API_URL","callGoogleVisionAsync","image","body","requests","content","features","type","maxResults","method","headers","JSON","stringify","json","parsed","responses","safeSearchAnnotation","adult","racy","violence","alert","storageRef","storage","ref","child","put","on","snapshot","progress1","bytesTransferred","totalBytes","state","TaskState","PAUSED","RUNNING","error","console","log","Alert","text","onPress","getDownloadURL","url","data","id","lat","coords","latitude","long","longitude","completed","slice","flex","width","elevation","borderRadius","paddingVertical","paddingHorizontal","backgroundColor","height","position","left","bottom","styles","backbtn","right","uploadbtn","Constants","Type","back","alignSelf","top","takePictureAsync","quality","base64","filename","getCurrentPositionAsync","shutterBtnCont","borderWidth","borderColor","display","justifyContent","alignItems","boarderColor","StyleSheet","create","color","fontSize","fontWeight","textTransform","marginBottom"],"mappings":"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","sourcesContent":["\nimport React, {useState, useEffect } from 'react';\nimport { Text, View, TouchableOpacity, ImageBackground, StyleSheet, Alert} from 'react-native'\nimport { Camera } from 'expo-camera'\nimport * as Location from 'expo-location';\nimport axios from 'axios';\nimport { v4 as uuidv4 } from 'uuid';\nimport firebase from '../../firebase.js'\nimport { preventAutoHide } from 'expo/build/launch/SplashScreen';\nimport * as Progress from 'react-native-progress';\n\nconst CameraView = ({user}) => {\n    const [hasPermission, setHasPermission] = useState(null);\n    const [cameraRef, setCameraRef] = useState(null);\n    const [photo, setPhoto] = useState(null);\n    const [location, setLocation] = useState(null);\n    const [imagePath, setImagePath] = useState(null);\n    const [progress, setProgress] = useState(null);\n    const [uploadComplete, setUploadComplete] = useState(true);\n\n    useEffect (() => {\n        (async () => {\n            const { status } = await Camera.requestPermissionsAsync();\n            const local = await Location.requestPermissionsAsync().status;\n            setHasPermission(status === 'granted');\n        })();\n    }, [])\n\n    const uploadPhoto = async () => {\n        try {\n            const response = await fetch(photo.uri);\n            const blob = await response.blob();\n\n            //converting blob to base 64\n            var reader = new FileReader();\n            reader.readAsDataURL(blob); \n            reader.onloadend = function() {\n                var base64data = reader.result;            \n           \n                const API_KEY = 'AIzaSyByFev4TGGQQW9leJiMUTdtfGl_YD4Jnb8';\n                const API_URL = `https://vision.googleapis.com/v1/images:annotate?key=${API_KEY}`\n                \n                async function callGoogleVisionAsync(image) {\n                  const body = {\n                    requests: [\n                      {\n                        image: {\n                          content: image,\n                        },\n                        features: [\n                          // {\n                          //   type: 'LABEL_DETECTION',\n                          //   maxResults: 5,\n                          // },\n                          {\n                            type: \"SAFE_SEARCH_DETECTION\",\n                            maxResults: 1\n                        },\n                        ]\n                      },\n                    ],\n                  };\n                \n                  const response = await fetch(API_URL, {\n                    method: 'POST',\n                    headers: {\n                      'Accept': 'application/json',\n                      'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify(body),\n                  });\n                  const parsed = await response.json();\n                  if(parsed.responses[0].safeSearchAnnotation.adult === 'VERY_LIKELY'\n                    || parsed.responses[0].safeSearchAnnotation.adult === 'LIKELY'\n                    || parsed.responses[0].safeSearchAnnotation.adult === 'POSSIBLE'\n                    || parsed.responses[0].safeSearchAnnotation.racy === 'VERY_LIKELY'\n                    || parsed.responses[0].safeSearchAnnotation.racy === 'LIKELY'\n                    || parsed.responses[0].safeSearchAnnotation.racy === 'POSSIBLE'\n                    || parsed.responses[0].safeSearchAnnotation.violence === 'VERY_LIKELY'\n                    || parsed.responses[0].safeSearchAnnotation.violence === 'LIKELY'\n                    || parsed.responses[0].safeSearchAnnotation.violence === 'POSSIBLE'\n                  \n                    ) {\n                      alert('Your image is not appropriate. Please try again')\n                    } else {\n                      const storageRef = firebase.storage().ref().child('images/' + imagePath)\n                      setUploadComplete(false)\n                      storageRef.put(blob)\n                          .on('state_changed', snapshot => {\n                              let progress1 = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n                              setProgress(progress1);\n                              switch (snapshot.state) {\n                                  case firebase.storage.TaskState.PAUSED:\n                                      break;\n                                  case firebase.storage.TaskState.RUNNING:\n                                      break;\n                              }\n                          }, error => {\n                              console.log(error)\n                          }, async () => {\n                              if (progress === 100 || progress === null) {\n                                  Alert.alert('Upload', 'Upload Complete', [{ text: 'OK', onPress: () => {setUploadComplete('true')}}]);    \n                              }\n          \n                              let url = await storageRef.getDownloadURL();\n                              await axios({\n                                  method: 'post',\n                                  url: 'https://us-central1-trash-2b5de.cloudfunctions.net/app/api/locations',\n                                  data: {\n                                    id: uuidv4(),\n                                    lat: location.coords.latitude,\n                                    long: location.coords.longitude,\n                                    completed: false,\n                                    uri: url,\n                                    user: user\n                                  }\n                              })\n                            });\n                    }\n                \n                  return parsed.responses[0];\n                }\n            \n                callGoogleVisionAsync(base64data.slice(23))\n            }   \n           \n        } catch (error) {\n            console.log(error)\n        }\n    }\n\n    if (hasPermission === null) {\n        return <View />;\n    }\n    if (hasPermission === false) {\n        return <Text>No access to camera</Text>;\n    }\n    return (\n       <View style= {{ flex: 1, width: '100%'}}> \n           {photo ? (<ImageBackground \n            style={{ flex: 1}}\n            source={{ uri: photo.uri}}>\n            <TouchableOpacity\n                onPress={()=> {\n                    setPhoto(null);\n                }}\n                style={{\n                    elevation: 8,\n                    borderRadius: 10,\n                    paddingVertical: 10,\n                    paddingHorizontal: 12,\n                    backgroundColor: '#D65F56',\n                    height: 45,\n                    width: 120,\n                    position: 'absolute',\n                    left: 20,\n                    bottom: 20\n                }}\n                >\n               <Text style={styles.backbtn}>Back</Text> \n            </TouchableOpacity>\n            <TouchableOpacity\n                onPress={ async () => {\n                    await uploadPhoto();\n                    setPhoto(null);\n                }}\n                style={{\n                    elevation: 8,\n                    borderRadius: 10,\n                    paddingVertical: 10,\n                    paddingHorizontal: 12,\n                    backgroundColor: '#148744',\n                    height: 45,\n                    width: 120,\n                    position: 'absolute',\n                    right: 20,\n                    bottom: 20\n                }}\n                >\n               <Text style={styles.uploadbtn}>Upload</Text> \n            </TouchableOpacity>\n            \n            </ImageBackground>\n            )\n           \n            : (<Camera style={{flex: 1}} type={Camera.Constants.Type.back} ref={ref => {\n               setCameraRef(ref);\n           }}>\n               <View\n               style={{\n                   flex: 1,\n                   alignSelf: 'center'\n               }}>\n                {uploadComplete === false ? <Progress.Bar progress={progress} width={200} style={{position: 'relative', top: 75}} /> : <View />}\n                <TouchableOpacity style={{alignSelf: 'center'}} onPress={async()=>{\n                    if (cameraRef) {\n                        let photo = await cameraRef.takePictureAsync({\n                            quality: 0.1,\n                            base64: true,\n                        });\n                        const filename = uuidv4();\n                        setPhoto(photo);\n                        setImagePath(filename);\n                        let location = await Location.getCurrentPositionAsync({});\n                        setLocation(location);\n                    }\n                }}>\n                    <View style={styles.shutterBtnCont}>\n                        <View style={{\n                            borderWidth: 2,\n                            borderRadius: \"10%\",\n                            borderColor: 'white',\n                            height: 50,\n                            display: 'flex',\n                            justifyContent: 'center',\n                            alignItems: 'center',\n                            }}\n                            >\n                                <View style={{\n                                    borderWidth: 2,\n                                    borderRadius: \"50%\",\n                                    boarderColor: 'white',\n                                    height: 40,\n                                    width: 40,\n                                    backgroundColor: 'white'\n                                }}>\n                            </View>\n                        </View>\n                    </View>\n                </TouchableOpacity>\n               </View>\n           </Camera>)}\n       </View>\n    );\n}\nconst styles = StyleSheet.create({\n    backbtn: {\n        color: 'white',\n        fontSize: 18,\n        fontWeight: 'bold',\n        alignSelf: 'center',\n        textTransform: 'uppercase'\n    },\n    uploadbtn: {\n        color: 'white',\n        fontSize: 18,\n        fontWeight: 'bold',\n        alignSelf: 'center',\n        textTransform: 'uppercase'\n        },\n    shutterBtnCont: {\n        flex: 1,\n        justifyContent: 'flex-end',\n        marginBottom: 36\n    }\n})\nexport default CameraView\n\n"]},"metadata":{},"sourceType":"module"}